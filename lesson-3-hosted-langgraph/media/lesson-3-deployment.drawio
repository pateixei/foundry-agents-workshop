<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/29.3.0 Chrome/140.0.7339.249 Electron/38.7.2 Safari/537.36" version="29.3.0">
  <diagram id="deployment" name="Deployment - LangGraph Hosted Agent">
    <mxGraphModel dx="1564" dy="936" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" parent="1" style="text;html=1;fontSize=20;fontStyle=1;align=center;verticalAlign=middle;whiteSpace=wrap;fillColor=none;strokeColor=none;fontColor=#1A1A2E;" value="Lesson 3 - Processo de Deployment: LangGraph Hosted Agent no Foundry" vertex="1">
          <mxGeometry height="40" width="1100" x="250" y="15" as="geometry" />
        </mxCell>
        <mxCell id="step1_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;arcSize=12;" value="" vertex="1">
          <mxGeometry height="210" width="180" x="40" y="90" as="geometry" />
        </mxCell>
        <mxCell id="step1_num" parent="1" style="ellipse;whiteSpace=wrap;html=1;fillColor=#1565C0;strokeColor=#0D47A1;fontSize=14;fontStyle=1;fontColor=#FFFFFF;" value="1" vertex="1">
          <mxGeometry height="30" width="30" x="50" y="97" as="geometry" />
        </mxCell>
        <mxCell id="step1_title" parent="1" style="text;html=1;fontSize=12;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#1565C0;" value="Escrever Codigo" vertex="1">
          <mxGeometry height="25" width="180" x="40" y="97" as="geometry" />
        </mxCell>
        <mxCell id="step1_file1" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#1565C0;fontSize=10;fontFamily=Courier New;" value="main.py" vertex="1">
          <mxGeometry height="25" width="140" x="60" y="130" as="geometry" />
        </mxCell>
        <mxCell id="step1_desc1" parent="1" style="text;html=1;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="LangGraph agent + tools&#xa;from_langgraph() adapter&#xa;Monkey-patch fixes" vertex="1">
          <mxGeometry height="35" width="140" x="60" y="155" as="geometry" />
        </mxCell>
        <mxCell id="step1_file2" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#1565C0;fontSize=10;fontFamily=Courier New;" value="Dockerfile" vertex="1">
          <mxGeometry height="25" width="140" x="60" y="195" as="geometry" />
        </mxCell>
        <mxCell id="step1_desc2" parent="1" style="text;html=1;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="python:3.12-slim&#xa;Port 8088&#xa;CMD [&quot;python&quot;, &quot;user_agent/main.py&quot;]" vertex="1">
          <mxGeometry height="35" width="140" x="60" y="220" as="geometry" />
        </mxCell>
        <mxCell id="step1_file3" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#1565C0;fontSize=9;fontFamily=Courier New;" value="requirements.txt" vertex="1">
          <mxGeometry height="25" width="140" x="60" y="260" as="geometry" />
        </mxCell>
        <mxCell id="arrow_1_2" edge="1" parent="1" source="step1_box" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="step2_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="step2_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#2E7D32;arcSize=12;" value="" vertex="1">
          <mxGeometry height="210" width="180" x="270" y="90" as="geometry" />
        </mxCell>
        <mxCell id="step2_num" parent="1" style="ellipse;whiteSpace=wrap;html=1;fillColor=#2E7D32;strokeColor=#1B5E20;fontSize=14;fontStyle=1;fontColor=#FFFFFF;" value="2" vertex="1">
          <mxGeometry height="30" width="30" x="280" y="97" as="geometry" />
        </mxCell>
        <mxCell id="step2_title" parent="1" style="text;html=1;fontSize=12;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#2E7D32;" value="Build no ACR" vertex="1">
          <mxGeometry height="25" width="180" x="270" y="97" as="geometry" />
        </mxCell>
        <mxCell id="step2_cmd" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;fontSize=10;fontFamily=Courier New;fontColor=#000099;align=left;spacingLeft=8;" value="az acr build&#xa;  --registry acr123&#xa;  --image lg-market-agent:v3&#xa;  --file Dockerfile&#xa;  --no-logs ." vertex="1">
          <mxGeometry height="80" width="156" x="282" y="135" as="geometry" />
        </mxCell>
        <mxCell id="step2_note" parent="1" style="text;html=1;fontSize=8;fontStyle=2;align=center;fillColor=#FFF9C4;strokeColor=#F9A825;rounded=1;fontColor=#666666;" value="--no-logs evita erro&#xa;UnicodeEncodeError&#xa;no Windows (cp1252)" vertex="1">
          <mxGeometry height="40" width="156" x="282" y="225" as="geometry" />
        </mxCell>
        <mxCell id="step2_icon" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#0078D4;strokeColor=#004E8C;fontSize=10;fontStyle=1;fontColor=#FFFFFF;" value="ACR" vertex="1">
          <mxGeometry height="24" width="90" x="315" y="270" as="geometry" />
        </mxCell>
        <mxCell id="arrow_2_3" edge="1" parent="1" source="step2_box" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="step3_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="step3_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#7B1FA2;arcSize=12;" value="" vertex="1">
          <mxGeometry height="210" width="180" x="500" y="90" as="geometry" />
        </mxCell>
        <mxCell id="step3_num" parent="1" style="ellipse;whiteSpace=wrap;html=1;fillColor=#7B1FA2;strokeColor=#4A148C;fontSize=14;fontStyle=1;fontColor=#FFFFFF;" value="3" vertex="1">
          <mxGeometry height="30" width="30" x="510" y="97" as="geometry" />
        </mxCell>
        <mxCell id="step3_title" parent="1" style="text;html=1;fontSize=12;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#7B1FA2;" value="Capability Host" vertex="1">
          <mxGeometry height="25" width="180" x="500" y="97" as="geometry" />
        </mxCell>
        <mxCell id="step3_desc" parent="1" style="text;html=1;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Criar Capability Host&#xa;no nivel do Account&#xa;(se nao existir)" vertex="1">
          <mxGeometry height="35" width="160" x="510" y="130" as="geometry" />
        </mxCell>
        <mxCell id="step3_cmd" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;fontSize=10;fontFamily=Courier New;fontColor=#660066;align=left;spacingLeft=6;" value="az resource create&#xa;  --resource-type&#xa;  Microsoft.Cognitive&#xa;  Services/accounts/&#xa;  capabilityHosts&#xa;  --properties&#xa;  enablePublicHosting&#xa;  Environment=true" vertex="1">
          <mxGeometry height="115" width="156" x="512" y="170" as="geometry" />
        </mxCell>
        <mxCell id="arrow_3_4" edge="1" parent="1" source="step3_box" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="step4_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="step4_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#E65100;arcSize=12;" value="" vertex="1">
          <mxGeometry height="210" width="180" x="730" y="90" as="geometry" />
        </mxCell>
        <mxCell id="step4_num" parent="1" style="ellipse;whiteSpace=wrap;html=1;fillColor=#E65100;strokeColor=#BF360C;fontSize=14;fontStyle=1;fontColor=#FFFFFF;" value="4" vertex="1">
          <mxGeometry height="30" width="30" x="740" y="97" as="geometry" />
        </mxCell>
        <mxCell id="step4_title" parent="1" style="text;html=1;fontSize=12;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#E65100;" value="Configurar RBAC" vertex="1">
          <mxGeometry height="25" width="180" x="730" y="97" as="geometry" />
        </mxCell>
        <mxCell id="step4_desc" parent="1" style="text;html=1;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Managed Identity do Projeto&#xa;precisa de 2 roles:" vertex="1">
          <mxGeometry height="25" width="160" x="740" y="130" as="geometry" />
        </mxCell>
        <mxCell id="step4_role1" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FF9800;strokeColor=#E65100;fontSize=10;fontStyle=1;fontColor=#FFFFFF;" value="AcrPull" vertex="1">
          <mxGeometry height="28" width="150" x="750" y="163" as="geometry" />
        </mxCell>
        <mxCell id="step4_role1_scope" parent="1" style="text;html=1;fontSize=8;fontStyle=2;align=center;fillColor=none;strokeColor=none;fontColor=#999;" value="Scope: Azure Container Registry" vertex="1">
          <mxGeometry height="15" width="150" x="750" y="191" as="geometry" />
        </mxCell>
        <mxCell id="step4_role2" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FF9800;strokeColor=#E65100;fontSize=10;fontStyle=1;fontColor=#FFFFFF;" value="Cognitive Services&#xa;OpenAI User" vertex="1">
          <mxGeometry height="35" width="150" x="750" y="215" as="geometry" />
        </mxCell>
        <mxCell id="step4_role2_scope" parent="1" style="text;html=1;fontSize=8;fontStyle=2;align=center;fillColor=none;strokeColor=none;fontColor=#999;" value="Scope: AI Foundry Account" vertex="1">
          <mxGeometry height="15" width="150" x="750" y="250" as="geometry" />
        </mxCell>
        <mxCell id="step4_principal" parent="1" style="text;html=1;fontSize=8;fontStyle=2;align=center;fillColor=#FFF9C4;strokeColor=#F9A825;rounded=1;fontColor=#666666;" value="Principal: Project Managed Identity" vertex="1">
          <mxGeometry height="20" width="158" x="745" y="270" as="geometry" />
        </mxCell>
        <mxCell id="step5_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE4EC;strokeColor=#C62828;arcSize=12;" value="" vertex="1">
          <mxGeometry height="210" width="370" x="220" y="370" as="geometry" />
        </mxCell>
        <mxCell id="step5_cmd1" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;fontSize=10;fontFamily=Courier New;fontColor=#660000;align=left;spacingLeft=8;" value="az cognitiveservices agent create \&#xa;  --account-name ai-foundry001 \&#xa;  --project-name ag365-prj001 \&#xa;  --name lg-market-agent \&#xa;  --agent-version 3 \&#xa;  --container-image acr123.azurecr.io/lg-market-agent:v3 \&#xa;  --no-start" vertex="1">
          <mxGeometry height="95" width="350" x="230" y="400" as="geometry" />
        </mxCell>
        <mxCell id="step5_cmd2" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;fontSize=10;fontFamily=Courier New;fontColor=#006600;align=left;spacingLeft=8;" value="az cognitiveservices agent start \&#xa;  --account-name ai-foundry001 \&#xa;  --project-name ag365-prj001 \&#xa;  --name lg-market-agent \&#xa;  --agent-version 3" vertex="1">
          <mxGeometry height="65" width="350" x="230" y="500" as="geometry" />
        </mxCell>
        <mxCell id="arrow_4_5" edge="1" parent="1" source="step4_box" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;strokeWidth=2;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;" target="step5_box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="820" y="340" />
              <mxPoint x="620" y="340" />
              <mxPoint x="620" y="370" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow_4_5_label" parent="1" style="text;html=1;fontSize=8;fontStyle=2;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="(prerequisitos prontos)" vertex="1">
          <mxGeometry height="15" width="130" x="630" y="325" as="geometry" />
        </mxCell>
        <mxCell id="step6_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8EAF6;strokeColor=#283593;arcSize=12;" value="" vertex="1">
          <mxGeometry height="210" width="180" x="620" y="370" as="geometry" />
        </mxCell>
        <mxCell id="step6_num" parent="1" style="ellipse;whiteSpace=wrap;html=1;fillColor=#283593;strokeColor=#1A237E;fontSize=14;fontStyle=1;fontColor=#FFFFFF;" value="6" vertex="1">
          <mxGeometry height="30" width="30" x="630" y="377" as="geometry" />
        </mxCell>
        <mxCell id="step6_title" parent="1" style="text;html=1;fontSize=12;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#283593;" value="Verificar Status" vertex="1">
          <mxGeometry height="25" width="180" x="620" y="377" as="geometry" />
        </mxCell>
        <mxCell id="step6_cmd" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;fontSize=8;fontFamily=Courier New;fontColor=#003366;align=left;spacingLeft=8;" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;az cognitiveservices&lt;br&gt;  agent show \&lt;br&gt;  --name lg-market-agent&lt;br&gt;  --agent-version 3&lt;/font&gt;" vertex="1">
          <mxGeometry height="55" width="156" x="632" y="410" as="geometry" />
        </mxCell>
        <mxCell id="step6_status" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#2E7D32;fontSize=9;align=center;fontStyle=1;fontColor=#2E7D32;" value="provisioningState:&#xa;&quot;Succeeded&quot;&#xa;&#xa;containerState:&#xa;&quot;Running&quot;" vertex="1">
          <mxGeometry height="70" width="140" x="640" y="475" as="geometry" />
        </mxCell>
        <mxCell id="arrow_5_6" edge="1" parent="1" source="step5_box" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="step6_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="step7_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E0F7FA;strokeColor=#00695C;arcSize=12;" value="" vertex="1">
          <mxGeometry height="240" width="280" x="850" y="370" as="geometry" />
        </mxCell>
        <mxCell id="step7_num" parent="1" style="ellipse;whiteSpace=wrap;html=1;fillColor=#00695C;strokeColor=#004D40;fontSize=14;fontStyle=1;fontColor=#FFFFFF;" value="7" vertex="1">
          <mxGeometry height="30" width="30" x="860" y="377" as="geometry" />
        </mxCell>
        <mxCell id="step7_title" parent="1" style="text;html=1;fontSize=12;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#00695C;" value="Testar via Responses API" vertex="1">
          <mxGeometry height="25" width="280" x="850" y="377" as="geometry" />
        </mxCell>
        <mxCell id="step7_cmd" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;fontSize=9;fontFamily=Courier New;fontColor=#006633;align=left;spacingLeft=8;arcSize=6;" value="POST https://ai-foundry001&#xa;  .services.ai.azure.com/api/&#xa;  projects/ag365-prj001/&#xa;  openai/responses&#xa;  ?api-version=2025-11-15-preview&#xa;&#xa;Body:&#xa;{&#xa;  &quot;input&quot;: [{&quot;role&quot;:&quot;user&quot;,&#xa;    &quot;content&quot;:&quot;...&quot;}],&#xa;  &quot;agent&quot;: {&#xa;    &quot;id&quot;: &quot;{agent-id}&quot;,&#xa;    &quot;name&quot;: &quot;lg-market-agent&quot;,&#xa;    &quot;version&quot;: &quot;3&quot;,&#xa;    &quot;type&quot;: &quot;agent_reference&quot;&#xa;  }&#xa;}" vertex="1">
          <mxGeometry height="190" width="256" x="862" y="410" as="geometry" />
        </mxCell>
        <mxCell id="arrow_6_7" edge="1" parent="1" source="step6_box" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="step7_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="success" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4CAF50;strokeColor=#2E7D32;fontSize=16;fontStyle=1;fontColor=#FFFFFF;shadow=1;" value="Agent Deployed!" vertex="1">
          <mxGeometry height="50" width="200" x="1170" y="445" as="geometry" />
        </mxCell>
        <mxCell id="arrow_7_done" edge="1" parent="1" source="step7_box" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#4CAF50;strokeWidth=3;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="success">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="summary_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#9E9E9E;dashed=1;" value="" vertex="1">
          <mxGeometry height="55" width="1330" x="40" y="620" as="geometry" />
        </mxCell>
        <mxCell id="summary_title" parent="1" style="text;html=1;fontSize=10;fontStyle=1;align=left;fillColor=none;strokeColor=none;" value="Resumo do Fluxo:" vertex="1">
          <mxGeometry height="20" width="100" x="50" y="625" as="geometry" />
        </mxCell>
        <mxCell id="summary" parent="1" style="text;html=1;fontSize=9;align=left;fillColor=none;strokeColor=none;fontColor=#555555;spacingLeft=5;" value="Codigo (main.py + Dockerfile) -&gt; ACR Build (az acr build --no-logs) -&gt; Capability Host -&gt; RBAC (AcrPull + OpenAI User) -&gt; Registrar Agent (az cognitiveservices agent create --no-start) -&gt; Iniciar (start) -&gt; Verificar (show) -&gt; Testar (POST /openai/responses)" vertex="1">
          <mxGeometry height="25" width="1300" x="50" y="645" as="geometry" />
        </mxCell>
        <mxCell id="workaround_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F9A825;dashed=1;" value="" vertex="1">
          <mxGeometry height="80" width="1330" x="40" y="690" as="geometry" />
        </mxCell>
        <mxCell id="workaround_title" parent="1" style="text;html=1;fontSize=10;fontStyle=1;align=left;fillColor=none;strokeColor=none;fontColor=#F57F17;" value="(!) Workarounds Importantes (Preview):" vertex="1">
          <mxGeometry height="20" width="250" x="50" y="695" as="geometry" />
        </mxCell>
        <mxCell id="workaround_list" parent="1" style="text;html=1;fontSize=8;align=left;fillColor=none;strokeColor=none;fontColor=#666666;spacingLeft=5;" value="1. --no-logs no az acr build (Windows cp1252 encoding)    2. Monkey-patch AgentReference.id no main.py    3. api_version + azure_endpoint obrigatorios em init_chat_model()&#xa;4. Audience do token: https://ai.azure.com/.default (nao cognitiveservices)    5. Body do REST precisa campo &quot;id&quot; em agent (SDK nao inclui automaticamente)" vertex="1">
          <mxGeometry height="40" width="1300" x="50" y="718" as="geometry" />
        </mxCell>
        <mxCell id="step5_title" parent="1" style="text;html=1;fontSize=12;fontStyle=1;align=center;fillColor=none;strokeColor=none;fontColor=#C62828;" value="Registrar e Iniciar Agent" vertex="1">
          <mxGeometry height="25" width="300" x="250" y="379.5" as="geometry" />
        </mxCell>
        <mxCell id="step5_num" parent="1" style="ellipse;whiteSpace=wrap;html=1;fillColor=#C62828;strokeColor=#B71C1C;fontSize=14;fontStyle=1;fontColor=#FFFFFF;" value="5" vertex="1">
          <mxGeometry height="30" width="30" x="231" y="377" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
